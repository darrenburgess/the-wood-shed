<div
    class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50"
    x-show="isEditTopicModalOpen"
    x-cloak
    @keydown.escape.window="isEditTopicModalOpen = false"
>
    <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4 p-6" @click.outside="isEditTopicModalOpen = false">
        <h3 class="text-xl font-semibold mb-4 text-gray-900">Edit Topic</h3>
        <template x-if="editingTopic">
            <textarea
                x-model="editingTopic.title"
                class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 mb-4"
                rows="3"
                @keydown.enter="
                    if (!$event.shiftKey) {
                        $event.preventDefault();
                        dataLayer.updateTopicTitle(editingTopic.id, editingTopic.title);
                        isEditTopicModalOpen = false;
                        editingTopic = null;
                    }
                "
            ></textarea>
        </template>
        <div class="flex justify-between">
            <div>
                <button
                    class="text-white bg-red-700 hover:bg-red-800 focus:ring-4 focus:ring-red-300 font-medium rounded-lg text-sm px-5 py-2.5"
                    @click="
                        if (confirm('Are you sure you want to delete this topic and ALL its goals and logs?')) {
                            dataLayer.deleteTopic(editingTopic.id);
                            topics = topics.filter(t => t.id !== editingTopic.id);
                            isEditTopicModalOpen = false;
                            editingTopic = null;
                        }
                    "
                >Delete</button>
            </div>
            <div class="flex gap-2">
                <button class="text-gray-900 bg-white border border-gray-300 focus:outline-none hover:bg-gray-100 focus:ring-4 focus:ring-gray-100 font-medium rounded-lg text-sm px-5 py-2.5" @click="isEditTopicModalOpen = false; editingTopic = null">Cancel</button>
                <button
                    class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5"
                    @click="
                        dataLayer.updateTopicTitle(editingTopic.id, editingTopic.title);
                        isEditTopicModalOpen = false;
                        editingTopic = null;
                    "
                >Save Changes</button>
            </div>
        </div>
    </div>
</div>
